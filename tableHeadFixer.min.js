/*!
TableHeadFixer plugin for JQuery
Version 1.1.0
Copyright (C) 2016 Lai Xuancheng <lai32690@gmail.com>
License MIT
*/
(function($,window){$.fn.tableHeadFixer=function(e){var h={head:true,foot:false,left:0,right:0,styledelay:20,"z-index":0};var f=$.extend({},h,e);return this.each(function(){f.table=this;f.parent=$(this).parent();j();if(f.head==true){c()}if(f.foot==true){g()}if(f.left>0){l()}if(f.right>0){a()}i();$(f.parent).trigger("scroll");$(window).resize(function(){$(f.parent).trigger("scroll")})});function i(){var o=null;var n;if(f.head){if(f.left>0||f.right>0){n=$(f.table).find("thead tr");if(n.length>0){o=$();if(f.left>0){n.each(function(p,q){k(q,function(r){o=o.add(r)})})}if(f.right>0){n.each(function(p,q){d(q,function(r){o=o.add(r)})})}}}}if(f.foot){if(f.left>0||f.right>0){n=$(f.table).find("tfoot tr");if(n.length>0){if(!o){o=$()}if(f.left>0){n.each(function(p,q){k(q,function(r){o=o.add(r)})})}if(f.right>0){n.each(function(p,q){d(q,function(r){o=o.add(r)})})}}}}if(o&&o.length>0){setTimeout(function(){var p=$('<div style="background:none;display:none;"/>').appendTo($(f.parent));var q=p.css("background-color");p.remove();o.each(function(s,r){for(var u=r;u!=null;u=u.parentElement){var t=$(u).css("background-color");if(t&&t!==q){if(u!=r){$(r).css("background-color",t)}return}}$(r).css("background-color","#FFF")}).css("z-index",f["z-index"]+1)},f.styledelay)}}function j(){var n=$(f.parent);var o=$(f.table);n.append(o).css({overflow:"auto","overflow-x":"auto","overflow-y":"auto"}).scroll(function(){var r=f.parent;var s=r.scrollWidth;var v=r.clientWidth;var x=r.scrollHeight;var t=r.clientHeight;var u=n.scrollTop();var p=x-t-u;var q=n.scrollLeft();var w=s-v-q;if(f.head){this.find("thead tr > *").css("top",u)}if(f.left>0){f.leftColumns.css("left",q)}if(f.right>0){f.rightColumns.css("right",w)}if(f.foot){this.find("tfoot tr > *").css("bottom",p)}}.bind(o))}function c(){var n=$(f.table).find("thead tr > *");n.css("position","relative")}function g(){var n=$(f.table).find("tfoot tr > *");n.css("position","relative")}function l(){var o=$(f.table).find("tr");var n=$();o.each(function(p,q){k(q,function(r){n=n.add(r)})});if(n.length>0){n.css("position","relative");f.leftColumns=n}}function a(){var o=$(f.table).find("tr");var n=$();o.each(function(p,q){d(q,function(r){n=n.add(r)})});if(n.length>0){n.css("position","relative");f.rightColumns=n}}function k(t,r){var o=f.left;var s=1;for(var p=1;p<=o;p=p+s){var q=s>1?p-1:p;var n=$(t).find("> *:nth-child("+q+")");var u=n.prop("colspan");if(m(n).left<o){r(n)}s=u}}function d(t,r){var o=f.right;var s=1;for(var p=1;p<=o;p=p+s){var q=s>1?p-1:p;var n=$(t).find("> *:nth-last-child("+q+")");var u=n.prop("colspan");r(n);s=u}}function m(q,n){var p=q.data("cellPos");if(!p||n){var o=q.closest("table, thead, tbody, tfoot");b(o);p=q.data("cellPos")}return p}function b(o){var n=[];o.children("tr").each(function(q,p){$(p).children("td, th").each(function(t,s){var y=$(s),v=y.attr("colspan")|0,w=y.attr("rowspan")|0,u,r;v=v?v:1;w=w?w:1;for(;n[q]&&n[q][t];++t){}for(u=t;u<t+v;++u){for(r=q;r<q+w;++r){if(!n[r]){n[r]=[]}n[r][u]=true}}var z={top:q,left:t};y.data("cellPos",z)})})}}})(jQuery,window);